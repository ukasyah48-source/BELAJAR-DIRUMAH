<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manajemen Tugas Siswa Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes progressFill {
      from { width: 0; }
    }
    
    .fade-in {
      animation: fadeIn 0.4s ease-out;
    }
    
    .slide-in {
      animation: slideIn 0.4s ease-out;
    }
    
    .card-shadow {
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.15);
    }
    
    .input-focus:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
    }

    .tab-button {
      transition: all 0.3s;
      cursor: pointer;
      position: relative;
    }

    .tab-button.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #6366f1, #8b5cf6);
      border-radius: 3px 3px 0 0;
    }

    .filter-chip {
      transition: all 0.3s;
      cursor: pointer;
    }

    .filter-chip:hover {
      transform: translateY(-2px);
    }

    .task-item {
      transition: all 0.3s;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .task-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }

    .task-item:hover::before {
      left: 100%;
    }

    .task-item:hover {
      transform: translateX(8px);
    }

    .modal-backdrop {
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
    }

    .progress-bar {
      height: 8px;
      background: #e5e7eb;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #059669);
      border-radius: 10px;
      transition: width 0.5s ease;
      animation: progressFill 1s ease-out;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      padding: 5%;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: pulse 3s ease-in-out infinite;
    }

    .tag-badge {
      display: inline-block;
      padding: 1% 3%;
      background: #e0e7ff;
      color: #4f46e5;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: 600;
      margin: 1% 1% 0 0;
    }

    .deadline-warning {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 2%;
      border-radius: 8px;
      margin-top: 2%;
    }

    .deadline-danger {
      background: #fee2e2;
      border-left: 4px solid #ef4444;
      padding: 2%;
      border-radius: 8px;
      margin-top: 2%;
    }

    .glassmorphism {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .floating-action {
      position: fixed;
      bottom: 5%;
      right: 5%;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      border: none;
      font-size: 1.5em;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
      transition: all 0.3s;
      z-index: 100;
    }

    .floating-action:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 15px 40px rgba(99, 102, 241, 0.6);
    }

    .search-box {
      position: relative;
    }

    .search-box input {
      padding-left: 12%;
    }

    .search-icon {
      position: absolute;
      left: 4%;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.2em;
      color: #9ca3af;
    }

    .tooltip {
      position: relative;
    }

    .tooltip::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 120%;
      left: 50%;
      transform: translateX(-50%);
      background: #1f2937;
      color: white;
      padding: 2% 4%;
      border-radius: 6px;
      font-size: 0.8em;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .tooltip:hover::after {
      opacity: 1;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="w-full min-h-full">
  <div class="w-full min-h-full" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%, #f093fb 100%);">
   <div class="w-full" style="padding: 2% 3%;">
    <div class="w-full" style="max-width: 1600px; margin: 0 auto;"><!-- Header dengan Animasi -->
     <header class="w-full text-center fade-in" style="margin-bottom: 2%;">
      <h1 id="app-title" style="font-size: 2.5em; font-weight: 900; color: #ffffff; margin-bottom: 0.5%; text-shadow: 3px 3px 6px rgba(0,0,0,0.3); letter-spacing: -1px;">ğŸ“š LAPORAN TUGAS WAJIB SMPIT BAITUL 'ILMI</h1>
      <p id="app-subtitle" style="font-size: 1.1em; color: #f0f4ff; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">Sistem Pencatatan Muraja'ah Harian Siswa</p>
     </header><!-- Dashboard Statistics dengan Design Modern -->
     <div class="w-full" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2%; margin-bottom: 3%;">
      <div class="card-shadow card-hover fade-in glassmorphism" style="border-radius: 24px; padding: 6%; text-align: center; background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(255, 255, 255, 0.95));">
       <div style="font-size: 3em; margin-bottom: 5%;">
        ğŸ“Š
       </div>
       <div id="stat-total" style="font-size: 2.8em; font-weight: 900; color: #6366f1; margin-bottom: 3%;">
        0
       </div>
       <div style="font-size: 0.9em; color: #6b7280; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">
        Total Tugas
       </div>
      </div>
      <div class="card-shadow card-hover fade-in glassmorphism" style="border-radius: 24px; padding: 6%; text-align: center; animation-delay: 0.2s; background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(255, 255, 255, 0.95));">
       <div style="font-size: 3em; margin-bottom: 5%;">
        ğŸ“š
       </div>
       <div id="stat-waktu" style="font-size: 2.8em; font-weight: 900; color: #8b5cf6; margin-bottom: 3%;">
        0
       </div>
       <div style="font-size: 0.9em; color: #6b7280; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">
        Mapel Diniyyah
       </div>
      </div>
      <div class="card-shadow card-hover fade-in glassmorphism" style="border-radius: 24px; padding: 6%; text-align: center; animation-delay: 0.3s; background: linear-gradient(135deg, rgba(236, 72, 153, 0.05), rgba(255, 255, 255, 0.95));">
       <div style="font-size: 3em; margin-bottom: 5%;">
        â¤ï¸
       </div>
       <div id="stat-orangtua" style="font-size: 2.8em; font-weight: 900; color: #ec4899; margin-bottom: 3%;">
        0
       </div>
       <div style="font-size: 0.9em; color: #6b7280; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">
        Membantu Orangtua
       </div>
      </div>
     </div><!-- Search Bar & Quick Actions -->
     <div class="w-full glassmorphism card-shadow" style="border-radius: 20px; padding: 2%; margin-bottom: 2%; display: flex; gap: 2%; align-items: center;">
      <div class="search-box" style="flex: 1; position: relative;"><span class="search-icon">ğŸ”</span> <input type="text" id="searchInput" placeholder="Cari tugas berdasarkan judul, nama, atau kategori..." style="width: 100%; padding: 3%; border: 2px solid #e5e7eb; border-radius: 15px; font-size: 0.95em; transition: all 0.3s;" class="input-focus">
      </div><button id="sortBtn" class="tooltip" data-tooltip="Urutkan Tugas" style="padding: 3% 5%; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; border-radius: 15px; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: all 0.3s; white-space: nowrap;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'"> ğŸ“… Urutkan </button> <button id="exportBtn" class="tooltip" data-tooltip="Ekspor Data" style="padding: 3% 5%; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 15px; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: all 0.3s; white-space: nowrap;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'"> ğŸ“¥ Ekspor </button>
     </div><!-- Tabs dengan Design Modern -->
     <div class="w-full glassmorphism card-shadow" style="border-radius: 20px; margin-bottom: 2%; padding: 1.5%;">
      <div style="display: flex; gap: 1%;"><button id="tab-form" class="tab-button active" style="flex: 1; padding: 3%; background: transparent; border: none; font-size: 1em; font-weight: 700; color: #6366f1;"> â• Tambah Tugas </button> <button id="tab-semua" class="tab-button" style="flex: 1; padding: 3%; background: transparent; border: none; font-size: 1em; font-weight: 700; color: #6b7280;"> ğŸ“‘ Semua Tugas </button>
      </div>
     </div><!-- Form Section dengan Design Enhanced -->
     <div id="section-form" class="w-full glassmorphism card-shadow" style="border-radius: 28px; padding: 5%; margin-bottom: 3%;">
      <div style="background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 20px; padding: 4%; margin-bottom: 5%; text-align: center;">
       <h2 id="form-title" style="font-size: 2em; font-weight: 900; color: #ffffff; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">âœï¸ Input Laporan Muraja'ah</h2>
      </div>
      <form id="taskForm"><input type="hidden" id="editingTaskId">
       <div class="w-full" style="margin-bottom: 4%;"><label for="namaSiswa" style="display: block; font-size: 1em; font-weight: 700; color: #374151; margin-bottom: 3%; display: flex; align-items: center; gap: 2%;"> <span style="font-size: 1.3em;">ğŸ‘¤</span> <span>Nama Siswa</span> </label> <input type="text" id="namaSiswa" required class="w-full input-focus" style="padding: 4%; border: 3px solid #e5e7eb; border-radius: 16px; font-size: 1.05em; transition: all 0.3s; background: #fafafa;" placeholder="Masukkan nama siswa">
       </div>
       <div class="w-full" style="margin-bottom: 4%;"><label for="judulTugas" style="display: block; font-size: 1em; font-weight: 700; color: #374151; margin-bottom: 3%; display: flex; align-items: center; gap: 2%;"> <span style="font-size: 1.3em;">ğŸ“–</span> <span>Muraja'ah Al-Quran : Juz Surat Ayat</span> </label> <input type="text" id="judulTugas" required class="w-full input-focus" style="padding: 4%; border: 3px solid #e5e7eb; border-radius: 16px; font-size: 1.05em; transition: all 0.3s; background: #fafafa;" placeholder="Contoh: Juz 1 Al-Baqarah 1-20, Juz 30 An-Nas">
       </div>
       <div class="w-full" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2.5%; margin-bottom: 5%;">
        <div style="background: linear-gradient(135deg, #eef2ff, #e0e7ff); padding: 6%; border-radius: 20px; border: 3px solid #c7d2fe; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(99, 102, 241, 0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"><label style="display: flex; align-items: center; gap: 4%; cursor: pointer; font-size: 1em; font-weight: 800; color: #4338ca;"> <input type="checkbox" id="prioritas" style="width: 28px; height: 28px; cursor: pointer; accent-color: #6366f1;"> <span style="display: flex; align-items: center; gap: 2%;"> <span style="font-size: 1.3em;">ğŸ“š</span> <span>Murajaah Mapel Diniyyah</span> </span> </label>
        </div>
        <div style="background: linear-gradient(135deg, #fef3c7, #fde68a); padding: 6%; border-radius: 20px; border: 3px solid #fcd34d; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(245, 158, 11, 0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"><label style="display: flex; align-items: center; gap: 4%; cursor: pointer; font-size: 1em; font-weight: 800; color: #92400e;"> <input type="checkbox" id="estimasiWaktu" style="width: 28px; height: 28px; cursor: pointer; accent-color: #f59e0b;"> <span style="display: flex; align-items: center; gap: 2%;"> <span style="font-size: 1.3em;">ğŸ“–</span> <span>Murajaah Mapel Umum</span> </span> </label>
        </div>
        <div style="background: linear-gradient(135deg, #fce7f3, #fbcfe8); padding: 6%; border-radius: 20px; border: 3px solid #f9a8d4; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(236, 72, 153, 0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"><label style="display: flex; align-items: center; gap: 4%; cursor: pointer; font-size: 1em; font-weight: 800; color: #9f1239;"> <input type="checkbox" id="tugasOrangtua" style="width: 28px; height: 28px; cursor: pointer; accent-color: #ec4899;"> <span style="display: flex; align-items: center; gap: 2%;"> <span style="font-size: 1.3em;">â¤ï¸</span> <span>Membantu Orangtua</span> </span> </label>
        </div>
       </div>
       <div class="w-full" style="display: flex; gap: 3%;"><button type="submit" id="submitBtn" style="flex: 1; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: #ffffff; font-size: 1.3em; font-weight: 900; padding: 5%; border: none; border-radius: 20px; cursor: pointer; transition: all 0.3s; box-shadow: 0 12px 24px rgba(99, 102, 241, 0.4); text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.transform='translateY(-4px) scale(1.02)'; this.style.boxShadow='0 18px 36px rgba(99, 102, 241, 0.5)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 12px 24px rgba(99, 102, 241, 0.4)'"> <span id="tombol-text">ğŸ’¾ Simpan Laporan</span> </button> <button type="button" id="cancelBtn" style="display: none; flex: 0.35; background: linear-gradient(135deg, #6b7280, #4b5563); color: #ffffff; font-size: 1.3em; font-weight: 900; padding: 5%; border: none; border-radius: 20px; cursor: pointer; transition: all 0.3s; box-shadow: 0 8px 16px rgba(107, 114, 128, 0.3);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px rgba(107, 114, 128, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 16px rgba(107, 114, 128, 0.3)'"> âœ–ï¸ Batal </button>
       </div>
      </form>
      <div id="successMessage" class="w-full fade-in" style="display: none; margin-top: 3%; padding: 3%; background: linear-gradient(135deg, #d1fae5, #a7f3d0); border-radius: 15px; text-align: center; border: 2px solid #10b981;">
       <p style="color: #065f46; font-weight: 700; font-size: 1.1em;">âœ… Laporan berhasil disimpan!</p>
      </div>
      <div id="errorMessage" class="w-full fade-in" style="display: none; margin-top: 3%; padding: 3%; background: linear-gradient(135deg, #fee2e2, #fecaca); border-radius: 15px; text-align: center; border: 2px solid #ef4444;">
       <p style="color: #991b1b; font-weight: 700; font-size: 1.1em;">âš ï¸ Gagal menyimpan laporan. Silakan coba lagi.</p>
      </div>
     </div><!-- Semua Tugas Section -->
     <div id="section-semua" class="w-full" style="display: none;">
      <div class="w-full glassmorphism card-shadow" style="border-radius: 28px; padding: 5%;">
       <div style="background: linear-gradient(135deg, #10b981, #059669); border-radius: 20px; padding: 4%; margin-bottom: 5%; text-align: center;">
        <h2 style="font-size: 2em; font-weight: 900; color: #ffffff; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">ğŸ“‘ Daftar Laporan Muraja'ah</h2>
       </div>
       <div id="semua-container"></div>
       <div id="emptyState" style="text-align: center; padding: 10%; color: #9ca3af;">
        <div style="font-size: 5em; margin-bottom: 3%;">
         ğŸ“‹
        </div>
        <p style="font-size: 1.5em; font-weight: 800; color: #6b7280;">Belum ada laporan.</p>
        <p style="font-size: 1.1em; margin-top: 2%; color: #9ca3af;">Tambahkan laporan muraja'ah pertama Anda!</p>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div><!-- Floating Action Button --> <button id="floatingBtn" class="floating-action" title="Tambah Tugas Cepat">+</button> <!-- Modal Detail Tugas -->
  <div id="detailModal" class="modal-backdrop" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; padding: 2%; overflow-y: auto;">
   <div class="glassmorphism card-shadow" style="max-width: 800px; margin: 3% auto; border-radius: 30px; padding: 5%; position: relative;"><button id="closeModal" style="position: absolute; top: 3%; right: 3%; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; border-radius: 50%; width: 45px; height: 45px; font-size: 1.5em; cursor: pointer; transition: all 0.3s; font-weight: bold; box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);" onmouseover="this.style.transform='rotate(90deg) scale(1.1)'" onmouseout="this.style.transform='rotate(0) scale(1)'">Ã—</button>
    <div id="detailContent"></div>
    <div style="display: flex; gap: 2%; margin-top: 5%;"><button id="editTaskBtn" style="flex: 1; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: #ffffff; font-size: 1em; font-weight: 700; padding: 4%; border: none; border-radius: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 15px rgba(99, 102, 241, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 10px rgba(99, 102, 241, 0.3)'"> âœï¸ Edit Tugas </button> <button id="deleteTaskBtn" style="flex: 0.4; background: linear-gradient(135deg, #ef4444, #dc2626); color: #ffffff; font-size: 1em; font-weight: 700; padding: 4%; border: none; border-radius: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 15px rgba(239, 68, 68, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 10px rgba(239, 68, 68, 0.3)'"> ğŸ—‘ï¸ </button>
    </div>
   </div>
  </div><!-- Toast Notification -->
  <div id="toast" style="display: none; position: fixed; top: 3%; right: 3%; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 3% 4%; border-radius: 15px; box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4); z-index: 2000; font-weight: 700; animation: slideIn 0.3s ease-out;"></div>
  <script>
    // LocalStorage functions
    const STORAGE_KEY = 'smpit_muraja_tasks';

    function loadTasks() {
      const data = localStorage.getItem(STORAGE_KEY);
      return data ? JSON.parse(data) : [];
    }

    function saveTasks(tasks) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
    }

    let allTasks = loadTasks();
    let currentFilter = 'semua';
    let currentDetailTask = null;
    let deleteClickCount = {};
    let currentSort = 'tanggal';
    let searchQuery = '';

    function updateStatistics() {
      const total = allTasks.length;
      const mapelDiniyyah = allTasks.filter(t => t.prioritas).length;
      const membantOrangtua = allTasks.filter(t => t.tugas_orangtua).length;

      document.getElementById('stat-total').textContent = total;
      document.getElementById('stat-waktu').textContent = mapelDiniyyah;
      document.getElementById('stat-orangtua').textContent = membantOrangtua;
    }

    function switchTab(tabName) {
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
        btn.style.color = '#6b7280';
      });

      document.getElementById('section-form').style.display = 'none';
      document.getElementById('section-semua').style.display = 'none';

      if (tabName === 'form') {
        document.getElementById('tab-form').classList.add('active');
        document.getElementById('tab-form').style.color = '#6366f1';
        document.getElementById('section-form').style.display = 'block';
      } else if (tabName === 'semua') {
        document.getElementById('tab-semua').classList.add('active');
        document.getElementById('tab-semua').style.color = '#6366f1';
        document.getElementById('section-semua').style.display = 'block';
      }
    }

    function getFilteredTasks() {
      let filtered = allTasks;

      if (searchQuery) {
        filtered = filtered.filter(t => 
          t.judul_tugas.toLowerCase().includes(searchQuery.toLowerCase()) ||
          t.nama_siswa.toLowerCase().includes(searchQuery.toLowerCase())
        );
      }

      return sortTasks(filtered);
    }

    function sortTasks(tasks) {
      const sorted = [...tasks];
      if (currentSort === 'tanggal') {
        sorted.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
      } else if (currentSort === 'prioritas') {
        sorted.sort((a, b) => {
          if (a.prioritas === b.prioritas) return 0;
          return a.prioritas ? -1 : 1;
        });
      }
      return sorted;
    }

    function cycleSortOrder() {
      if (currentSort === 'tanggal') {
        currentSort = 'prioritas';
        showToast('ğŸ“š Diurutkan berdasarkan Mapel Diniyyah');
      } else {
        currentSort = 'tanggal';
        showToast('ğŸ“… Diurutkan berdasarkan Tanggal');
      }
      renderTasks();
    }

    function renderTasks() {
      const filteredTasks = getFilteredTasks();
      renderSemuaView(filteredTasks);
      updateStatistics();
    }

    function renderSemuaView(tasks) {
      const container = document.getElementById('semua-container');
      const emptyState = document.getElementById('emptyState');

      if (tasks.length === 0) {
        container.innerHTML = '';
        emptyState.style.display = 'block';
      } else {
        emptyState.style.display = 'none';
        
        // Group tasks by date
        const groupedByDate = {};
        tasks.forEach(task => {
          const dateKey = new Date(task.tanggal).toLocaleDateString('id-ID', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
          });
          if (!groupedByDate[dateKey]) {
            groupedByDate[dateKey] = [];
          }
          groupedByDate[dateKey].push(task);
        });

        // Render grouped tasks
        let html = '';
        Object.keys(groupedByDate).forEach(dateKey => {
          const tasksForDate = groupedByDate[dateKey];
          html += `
            <div class="fade-in" style="margin-bottom: 4%;">
              <div style="background: linear-gradient(135deg, #6366f1, #8b5cf6); padding: 3%; border-radius: 15px; margin-bottom: 2%; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);">
                <h3 style="font-size: 1.3em; font-weight: 800; color: #ffffff; margin: 0; display: flex; align-items: center; gap: 2%;">
                  <span style="font-size: 1.2em;">ğŸ“…</span>
                  <span>${dateKey}</span>
                  <span style="background: rgba(255, 255, 255, 0.2); padding: 1% 3%; border-radius: 20px; font-size: 0.7em; margin-left: auto;">${tasksForDate.length} Tugas</span>
                </h3>
              </div>
              <div style="padding-left: 2%;">
                ${tasksForDate.map(task => renderTaskItem(task)).join('')}
              </div>
            </div>
          `;
        });
        
        container.innerHTML = html;
      }
    }

    function getPriorityIcon(prioritas) {
      return prioritas ? 'ğŸ“š' : 'ğŸ“‹';
    }

    function renderTaskItem(task) {
      const isDeletePending = deleteClickCount[task.id] === 1;
      
      return `
        <div class="task-item slide-in" data-task-id="${task.id}" style="background: #ffffff; border-radius: 18px; padding: 3.5%; margin-bottom: 2%; border-left: 6px solid #6366f1; ${isDeletePending ? 'border: 3px solid #ef4444; box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);' : 'box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);'}">
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <div style="flex: 1;" onclick="showTaskDetail('${task.id}')">
              <div style="display: flex; align-items: center; gap: 2%; margin-bottom: 2%; flex-wrap: wrap;">
                <span style="font-size: 1.4em;">${getPriorityIcon(task.prioritas)}</span>
                <h4 style="font-size: 1.2em; font-weight: 800; color: #374151;">${task.judul_tugas}</h4>
              </div>
              
              <div style="display: flex; align-items: center; gap: 3%; font-size: 0.9em; color: #6b7280; margin-bottom: 2%; flex-wrap: wrap;">
                <span style="font-weight: 600;">ğŸ‘¤ ${task.nama_siswa}</span>
                <span style="font-weight: 600;">ğŸ“š Diniyyah: ${task.prioritas ? 'Ya' : 'Tidak'}</span>
                <span style="font-weight: 600;">ğŸ“– Umum: ${task.estimasi_waktu ? 'Ya' : 'Tidak'}</span>
                <span style="font-weight: 600;">â¤ï¸ Orangtua: ${task.tugas_orangtua ? 'Ya' : 'Tidak'}</span>
                <span style="font-weight: 600;">ğŸ• ${new Date(task.tanggal).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}</span>
              </div>
            </div>
            
            <div style="display: flex; gap: 2%; flex-direction: column;">
              <button onclick="handleDeleteClick('${task.id}')" style="background: ${isDeletePending ? 'linear-gradient(135deg, #ef4444, #dc2626)' : '#f3f4f6'}; color: ${isDeletePending ? '#ffffff' : '#6b7280'}; padding: 3% 5%; border: none; border-radius: 12px; font-size: 0.9em; font-weight: 700; cursor: pointer; transition: all 0.3s; ${isDeletePending ? 'box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);' : ''}; white-space: nowrap;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                ${isDeletePending ? 'âœ“ Yakin?' : 'ğŸ—‘ï¸'}
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function showTaskDetail(taskId) {
      const task = allTasks.find(t => t.id === taskId);
      if (!task) return;

      currentDetailTask = task;
      const modal = document.getElementById('detailModal');
      const content = document.getElementById('detailContent');

      content.innerHTML = `
        <div style="margin-bottom: 4%;">
          <div style="display: flex; align-items: center; gap: 2%; margin-bottom: 3%; flex-wrap: wrap;">
            <h2 style="font-size: 2em; font-weight: 800; color: #374151; flex: 1;">${task.judul_tugas}</h2>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 3%; margin-bottom: 3%;">
          <div style="background: linear-gradient(135deg, #f9fafb, #f3f4f6); padding: 5%; border-radius: 15px; border: 2px solid #e5e7eb;">
            <div style="font-size: 0.85em; color: #6b7280; margin-bottom: 2%; font-weight: 600;">Nama Siswa</div>
            <div style="font-size: 1.2em; font-weight: 700; color: #374151;">ğŸ‘¤ ${task.nama_siswa}</div>
          </div>
          <div style="background: linear-gradient(135deg, #f9fafb, #f3f4f6); padding: 5%; border-radius: 15px; border: 2px solid #e5e7eb;">
            <div style="font-size: 0.85em; color: #6b7280; margin-bottom: 2%; font-weight: 600;">Murajaah Mapel Diniyyah</div>
            <div style="font-size: 1.2em; font-weight: 700; color: #374151;">${task.prioritas ? 'âœ… Ya' : 'â¬œ Tidak'}</div>
          </div>
          <div style="background: linear-gradient(135deg, #f9fafb, #f3f4f6); padding: 5%; border-radius: 15px; border: 2px solid #e5e7eb;">
            <div style="font-size: 0.85em; color: #6b7280; margin-bottom: 2%; font-weight: 600;">Murajaah Mapel Umum</div>
            <div style="font-size: 1.2em; font-weight: 700; color: #374151;">${task.estimasi_waktu ? 'âœ… Ya' : 'â¬œ Tidak'}</div>
          </div>
          <div style="background: linear-gradient(135deg, #f9fafb, #f3f4f6); padding: 5%; border-radius: 15px; border: 2px solid #e5e7eb;">
            <div style="font-size: 0.85em; color: #6b7280; margin-bottom: 2%; font-weight: 600;">Membantu Orangtua</div>
            <div style="font-size: 1.2em; font-weight: 700; color: #374151;">${task.tugas_orangtua ? 'âœ… Ya' : 'â¬œ Tidak'}</div>
          </div>
        </div>

        <div style="background: linear-gradient(135deg, #f9fafb, #f3f4f6); padding: 4%; border-radius: 15px; margin-bottom: 3%; border: 2px solid #e5e7eb;">
          <div style="font-size: 0.85em; color: #6b7280; margin-bottom: 2%; font-weight: 600;">ğŸ“… Tanggal Dibuat</div>
          <div style="font-size: 1em; font-weight: 700; color: #374151;">${new Date(task.tanggal).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</div>
        </div>
      `;

      modal.style.display = 'flex';
    }

    function handleDeleteClick(taskId) {
      if (!deleteClickCount[taskId]) {
        deleteClickCount[taskId] = 1;
        renderTasks();
        showToast('ğŸ—‘ï¸ Klik sekali lagi untuk menghapus');
        
        setTimeout(() => {
          if (deleteClickCount[taskId] === 1) {
            deleteClickCount[taskId] = 0;
            renderTasks();
          }
        }, 4000);
      } else {
        deleteTask(taskId);
        deleteClickCount[taskId] = 0;
      }
    }

    function deleteTask(taskId) {
      allTasks = allTasks.filter(t => t.id !== taskId);
      saveTasks(allTasks);
      renderTasks();
      showToast('âœ… Tugas berhasil dihapus');
    }

    function editTask(task) {
      document.getElementById('editingTaskId').value = task.id;
      document.getElementById('namaSiswa').value = task.nama_siswa;
      document.getElementById('judulTugas').value = task.judul_tugas;
      document.getElementById('prioritas').checked = task.prioritas || false;
      document.getElementById('estimasiWaktu').checked = task.estimasi_waktu || false;
      document.getElementById('tugasOrangtua').checked = task.tugas_orangtua || false;

      const formTitle = document.getElementById('form-title');
      formTitle.innerHTML = 'âœï¸ Edit Laporan Muraja\'ah';
      formTitle.parentElement.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
      document.getElementById('cancelBtn').style.display = 'block';
      document.getElementById('detailModal').style.display = 'none';
      
      switchTab('form');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function cancelEdit() {
      document.getElementById('taskForm').reset();
      document.getElementById('editingTaskId').value = '';
      const formTitle = document.getElementById('form-title');
      formTitle.innerHTML = 'âœï¸ Input Laporan Muraja\'ah';
      formTitle.parentElement.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
      document.getElementById('cancelBtn').style.display = 'none';
    }

    function showMessage(messageId) {
      const message = document.getElementById(messageId);
      message.style.display = 'block';
      setTimeout(() => {
        message.style.display = 'none';
      }, 3000);
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.style.display = 'block';
      setTimeout(() => {
        toast.style.display = 'none';
      }, 3000);
    }

    function exportData() {
      const csvContent = "data:text/csv;charset=utf-8," 
        + "Nama,Judul,Mapel Diniyyah,Mapel Umum,Membantu Orangtua,Tanggal\n"
        + allTasks.map(t => 
          `"${t.nama_siswa}","${t.judul_tugas}","${t.prioritas ? 'Ya' : 'Tidak'}","${t.estimasi_waktu ? 'Ya' : 'Tidak'}","${t.tugas_orangtua ? 'Ya' : 'Tidak'}","${new Date(t.tanggal).toLocaleDateString('id-ID')}"`
        ).join("\n");
      
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", `laporan_muraja_${new Date().toISOString().split('T')[0]}.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showToast('ğŸ“¥ Data berhasil diekspor');
    }

    // Event Listeners
    document.getElementById('tab-form').addEventListener('click', () => switchTab('form'));
    document.getElementById('tab-semua').addEventListener('click', () => switchTab('semua'));

    document.getElementById('searchInput').addEventListener('input', (e) => {
      searchQuery = e.target.value;
      renderTasks();
    });

    document.getElementById('sortBtn').addEventListener('click', cycleSortOrder);
    document.getElementById('exportBtn').addEventListener('click', exportData);

    document.getElementById('floatingBtn').addEventListener('click', () => {
      cancelEdit();
      switchTab('form');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    document.getElementById('closeModal').addEventListener('click', () => {
      document.getElementById('detailModal').style.display = 'none';
    });

    document.getElementById('editTaskBtn').addEventListener('click', () => {
      if (currentDetailTask) {
        editTask(currentDetailTask);
      }
    });

    document.getElementById('deleteTaskBtn').addEventListener('click', () => {
      if (currentDetailTask) {
        handleDeleteClick(currentDetailTask.id);
        document.getElementById('detailModal').style.display = 'none';
      }
    });

    document.getElementById('cancelBtn').addEventListener('click', cancelEdit);

    window.showTaskDetail = showTaskDetail;
    window.handleDeleteClick = handleDeleteClick;

    document.getElementById('taskForm').addEventListener('submit', (e) => {
      e.preventDefault();

      const editingId = document.getElementById('editingTaskId').value;

      const taskData = {
        id: editingId || Date.now().toString(),
        nama_siswa: document.getElementById('namaSiswa').value,
        judul_tugas: document.getElementById('judulTugas').value,
        prioritas: document.getElementById('prioritas').checked,
        estimasi_waktu: document.getElementById('estimasiWaktu').checked,
        tugas_orangtua: document.getElementById('tugasOrangtua').checked,
        tanggal: new Date().toISOString()
      };

      if (editingId) {
        // Update existing task
        const index = allTasks.findIndex(t => t.id === editingId);
        if (index !== -1) {
          allTasks[index] = taskData;
        }
      } else {
        // Add new task
        allTasks.push(taskData);
      }

      saveTasks(allTasks);
      showMessage('successMessage');
      showToast(editingId ? 'âœ… Tugas berhasil diperbarui' : 'âœ… Tugas berhasil ditambahkan');
      cancelEdit();
      renderTasks();
    });

    // Initial render
    renderTasks();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a36ed1e45e10884',t:'MTc2Mzk2NjU0NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>